<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Question</title>
  <link rel="icon" href="assets/favicon.png" />
  <link rel="stylesheet" href="css/question.css" />
  <link rel="stylesheet" href="css/game.css" />
  <style>
    .explanation-container {
      padding: 20px;
      margin-top: 10px;
      background-color: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .explanation-text {
      font-size: 16px;
      color: #333;
    }

    .retry-button {
      font-size: 16px;
      padding: 10px 20px;
      margin-top: 10px;
      margin-bottom: 16px;
      cursor: pointer;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }

    .retry-button:hover {
      background-color: #0056b3;
    }
  </style>
</head>

<body>
  <div class="container">
    <div id="game" class="justify-center flex-column">
      <div id="hud">
        <div class="hud-item">
          <p id="progressText" class="hud-prefix">Question</p>
          <div id="progressBar">
            <div id="progressBarFull"></div>
          </div>
        </div>
        <div class="hud-item">
          <p class="hud-prefix">Score</p>
          <h1 class="hud-main-text" id="score">0</h1>
        </div>
      </div>
      <h1 id="question">What is the answer to this question?</h1>
      <div class="choice-container">
        <p class="choice-prefix">A</p>
        <p class="choice-text" data-number="1">Choice 1</p>
      </div>
      <div class="choice-container">
        <p class="choice-prefix">B</p>
        <p class="choice-text" data-number="2">Choice 2</p>
      </div>
      <div class="choice-container">
        <p class="choice-prefix">C</p>
        <p class="choice-text" data-number="3">Choice 3</p>
      </div>
      <div class="choice-container">
        <p class="choice-prefix">D</p>
        <p class="choice-text" data-number="4">Choice 4</p>
      </div>
      <div id="explanation" class="hidden explanation-container">
        <p id="explanationText" class="explanation-text"></p>
        <button id="retryButton" class="retry-button" onclick="retryQuestion()">Try Again</button>
      </div>

    </div>
  </div>

  <script>
    const question = document.querySelector("#question");
    const choices = Array.from(document.querySelectorAll(".choice-text"));
    const progressText = document.querySelector("#progressText");
    const scoreText = document.querySelector("#score");
    const progressBarFull = document.querySelector("#progressBarFull");
    const explanationElement = document.querySelector("#explanation");
    const explanationText = document.querySelector("#explanationText");
    const retryButton = document.querySelector("#retryButton");

    let currentQuestion = {};
    let acceptingAnswers = true;
    let score = 0;
    let questionCounter = 0;
    let availableQuestions = [];
    let retries = 0; // Track retries for each question

    let questions = [
      {
        question: "What is a phishing link?",
        choice1: "It gives free gifts and vouchers",
        choice2: "It's something beneficial to us",
        choice3: "It's a scam link that tricks people",
        choice4: "It's a trustworthy link",
        answer: 3,
        explanation: "*Phishing links are used by scammers to steal your personal information or money by tricking you."
      },
      {
        question: "Should you trust an Amazon voucher like the one shown earlier?",
        choice1: "Yes, it looks genuine and exciting!",
        choice2: "No, it could be a phishing attempt",
        choice3: "I would share it with all my friends",
        choice4: "It's from a trusted source",
        answer: 2,
        explanation: "*Online vouchers like these can often be scams designed to steal your information. Always double-check the source!"
      },
    ];

    const SCORE_POINTS = 200;
    const MAX_QUESTIONS = questions.length;

    startGame = () => {
      questionCounter = 0;
      score = 0;
      retries = 0;
      availableQuestions = [...questions];
      getNewQuestion();
    };

    getNewQuestion = () => {
      retries = 0;
      hasRetried = false;

      if (questionCounter >= MAX_QUESTIONS) {
        localStorage.setItem("mostRecentScore", score);
        return window.location.assign("save_game.html");
      }

      questionCounter++;
      progressText.innerText = `Question ${questionCounter} of ${MAX_QUESTIONS}`;
      progressBarFull.style.width = `${(questionCounter / MAX_QUESTIONS) * 100}%`;

      currentQuestion = availableQuestions[questionCounter - 1];
      question.innerText = currentQuestion.question;

      choices.forEach((choice) => {
        const number = choice.dataset["number"];
        choice.innerText = currentQuestion["choice" + number];
        choice.parentElement.classList.remove("correct", "incorrect");
      });

      acceptingAnswers = true;
    };

    choices.forEach((choice) => {
      choice.addEventListener("click", (e) => {
        if (!acceptingAnswers) return;

        acceptingAnswers = false;
        const selectedChoice = e.target;
        const selectedAnswer = selectedChoice.dataset["number"];
        let classToApply = selectedAnswer == currentQuestion.answer ? "correct" : "incorrect";

        selectedChoice.parentElement.classList.add(classToApply);

        if (classToApply === "correct") {
          incrementScore(SCORE_POINTS);
          setTimeout(() => {
            getNewQuestion();
          }, 1000);
        } else {
          if (retries === 0) {
            retryButton.dataset.selectedChoice = selectedAnswer;
            explanationElement.classList.remove("hidden");
            explanationText.innerText = currentQuestion.explanation;
            retries++;
          } else {
            setTimeout(() => {
              getNewQuestion();
            }, 1000);
          }
        }
      });
    });

    retryQuestion = () => {
      if (retries !== 1) {
        return; // Retry only allowed once per question
      }

      const selectedNumber = retryButton.dataset.selectedChoice;
      const selectedChoice = document.querySelector(`[data-number="${selectedNumber}"]`);

      if (!selectedChoice) {
        console.error("Invalid choice selected.");
        return;
      }
      selectedChoice.parentElement.classList.remove("incorrect");
      explanationElement.classList.add("hidden");
      acceptingAnswers = true;
    };

    incrementScore = (num) => {
      score += num;
      scoreText.innerText = score;
    };

    startGame();

  </script>
</body>

</html>